[source]
tar = "https://www.python.org/ftp/python/3.12.0/Python-3.12.0.tar.xz"
patches = [
    "redox.patch"
]

[build]
template = "custom"
dependencies = [
    "bzip2",
    "libffi",
    "libuuid",
    "openssl3",
    "ncurses",
    "ncursesw",
    "readline",
    "sqlite3",
    "zlib",
    "xz",
    "zstd",
]
script = """
DYNAMIC_INIT
export PYTHONDONTWRITEBYTECODE=1
ARCH="${TARGET%%-*}"

# Packages are considerably larger because of this issue
# https://gitlab.redox-os.org/redox-os/relibc/-/issues/227
export MODULE_BUILDTYPE=static

COOKBOOK_CONFIGURE_FLAGS=(
    --prefix=/usr
    --enable-shared
    --disable-ipv6
    --host=${GNU_TARGET}
    --build=$ARCH
    --with-build-python=python3
    --with-ensurepip=install
    --disable-test-modules
    ac_cv_file__dev_ptmx=no
    ac_cv_file__dev_ptc=no
)

cookbook_configure
"""
