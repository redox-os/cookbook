#TODO depedencies needed
[source]
tar = "https://nodejs.org/dist/v24.5.0/node-v24.5.0.tar.gz"
patches = ["01_redox.patch"]

[build]
template = "custom"
depedencies = [
#   "ada",
    "libbrotli",
#   "cares",
    "libuv",
#   "ngtcp2",
    "nghttp2",
#   "http-parser",
#   "nghttp3",
    "openssl1",
    "simdjson",
#   "simdutf",
    "sqlite3",
#   "uvwasi",
    "zlib",
    "zstd",
]
script = """
DYNAMIC_INIT

case "${TARGET}" in
    x86-unknown-redox)
        export NODE_CPU=x32
        ;;
    x86_64-unknown-redox)
        export NODE_CPU=x64
        ;;
    aarch64-unknown-redox)
        export NODE_CPU=arm64
        ;;
esac

COOKBOOK_CONFIGURE_FLAGS=(
  --prefix=${COOKBOOK_STAGE}
  --dest-cpu=${NODE_CPU}
  --dest-os=redox
  --shared-libuv
  --shared-nghttp2
  --shared-openssl
  --shared-zlib
  --shared-zstd
  --cross-compiling
)
cookbook_configure
"""
